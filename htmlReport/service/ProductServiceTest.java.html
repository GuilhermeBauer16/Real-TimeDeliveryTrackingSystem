<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProductServiceTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">All in Real-TimeDeliveryTrackingSystem (1) Coverage Results</a> &gt; <a href="index.source.html" class="el_package">service</a> &gt; <span class="el_source">ProductServiceTest.java</span></div><h1>ProductServiceTest.java</h1><pre class="source lang-java linenums">package service;

import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.entity.ProductEntity;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.entity.values.ProductVO;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.exception.product.InvalidProductException;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.exception.product.ProductNotFoundException;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.repository.ProductRepository;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.service.product.ProductService;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.utils.ValidatorUtils;
import constants.TestConstants;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.MockedStatic;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;

import java.util.List;
import java.util.Optional;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.Mockito.doNothing;
import static org.mockito.Mockito.mockStatic;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

@ExtendWith(MockitoExtension.class)
<span class="fc" id="L38">public class ProductServiceTest {</span>

    private static final String PRODUCT_NOT_FOUND = &quot;This product was not found.&quot;;
    private static final String INVALID_PRODUCT_MESSAGE = &quot;This product is invalid, please verify the fields and try again.&quot;;

    private ProductVO productVO;
    private ProductEntity productEntity;
    @Mock
    private ProductRepository repository;

    @InjectMocks
    private ProductService service;

    @BeforeEach
    void setUp() {

<span class="fc" id="L54">        productVO = new ProductVO(TestConstants.ID, TestConstants.PRODUCT_NAME,</span>
                TestConstants.PRODUCT_DESCRIPTION, TestConstants.PRODUCT_PRICE,TestConstants.PRODUCT_QUANTITY);

<span class="fc" id="L57">        productEntity = new ProductEntity(TestConstants.ID, TestConstants.PRODUCT_NAME,</span>
                TestConstants.PRODUCT_DESCRIPTION, TestConstants.PRODUCT_PRICE,TestConstants.PRODUCT_QUANTITY);

<span class="fc" id="L60">    }</span>

    @Test
    void testCreateProduct_WhenSuccessful_ShouldReturnProductObject() {

<span class="fc" id="L65">        try (MockedStatic&lt;ValidatorUtils&gt; mockedValidatorUtils = mockStatic(ValidatorUtils.class)) {</span>

<span class="fc" id="L67">            mockedValidatorUtils.when(() -&gt; ValidatorUtils.checkObjectIsNullOrThrowException(any(),</span>
<span class="fc" id="L68">                    anyString(), any())).thenAnswer(invocation -&gt; null);</span>
<span class="fc" id="L69">            mockedValidatorUtils.when(() -&gt; ValidatorUtils.checkFieldNotNullAndNotEmptyOrThrowException(</span>
<span class="fc" id="L70">                    any(), anyString(), any())).thenAnswer(invocation -&gt; null);</span>

<span class="fc" id="L72">            when(repository.save(any(ProductEntity.class))).thenReturn(productEntity);</span>

<span class="fc" id="L74">            ProductVO product = service.createProduct(productVO);</span>

<span class="fc" id="L76">            verify(repository, times(1)).save(any(ProductEntity.class));</span>
<span class="fc" id="L77">            mockedValidatorUtils.verify(() -&gt; ValidatorUtils.checkObjectIsNullOrThrowException(any(), anyString(), any()));</span>
<span class="fc" id="L78">            mockedValidatorUtils.verify(() -&gt; ValidatorUtils.checkFieldNotNullAndNotEmptyOrThrowException(any(), anyString(), any()));</span>

<span class="fc" id="L80">            assertNotNull(product);</span>
<span class="fc" id="L81">            assertNotNull(product.getId());</span>
<span class="fc" id="L82">            assertEquals(TestConstants.ID, product.getId());</span>
<span class="fc" id="L83">            assertEquals(TestConstants.PRODUCT_NAME, product.getName());</span>
<span class="fc" id="L84">            assertEquals(TestConstants.PRODUCT_DESCRIPTION, product.getDescription());</span>
<span class="fc" id="L85">            assertEquals(TestConstants.PRODUCT_PRICE, product.getPrice());</span>
<span class="fc" id="L86">            assertEquals(TestConstants.PRODUCT_QUANTITY, product.getQuantity());</span>
        }
<span class="fc" id="L88">    }</span>

    @Test
    void testCreateProduct_WhenProductIsNull_ShouldThrowInvalidProductException() {

<span class="fc" id="L93">        InvalidProductException exception = assertThrows(InvalidProductException.class,</span>
<span class="nc" id="L94">                () -&gt; service.createProduct(null));</span>

<span class="fc" id="L96">        assertNotNull(exception);</span>
<span class="fc" id="L97">        assertEquals(InvalidProductException.ERROR.formatErrorMessage(INVALID_PRODUCT_MESSAGE)</span>
<span class="fc" id="L98">                , exception.getMessage());</span>
<span class="fc" id="L99">    }</span>

    @Test
    void testUpdateProduct_WhenSuccessful_ShouldReturnUpdatedProductObject() {


<span class="fc" id="L105">        try (MockedStatic&lt;ValidatorUtils&gt; mockedValidatorUtils = mockStatic(ValidatorUtils.class)) {</span>

<span class="fc" id="L107">            productEntity.setName(TestConstants.PRODUCT_UPDATED_NAME);</span>
<span class="fc" id="L108">            productEntity.setPrice(TestConstants.PRODUCT_UPDATED_PRICE);</span>

<span class="fc" id="L110">            mockedValidatorUtils.when(() -&gt; ValidatorUtils.updateFieldIfNotNull(any(ProductEntity.class)</span>
<span class="fc" id="L111">                    , any(), anyString(), any())).thenAnswer(invocation -&gt; productEntity);</span>

<span class="fc" id="L113">            mockedValidatorUtils.when(() -&gt; ValidatorUtils.checkFieldNotNullAndNotEmptyOrThrowException(</span>
<span class="fc" id="L114">                    any(), anyString(), any())).thenAnswer(invocation -&gt; null);</span>

<span class="fc" id="L116">            when(repository.findById(anyString())).thenReturn(Optional.of(productEntity));</span>
<span class="fc" id="L117">            when(repository.save(any(ProductEntity.class))).thenReturn(productEntity);</span>

<span class="fc" id="L119">            ProductVO product = service.updateProduct(productVO);</span>

<span class="fc" id="L121">            verify(repository, times(1)).save(any(ProductEntity.class));</span>
<span class="fc" id="L122">            verify(repository, times(1)).findById(anyString());</span>

<span class="fc" id="L124">            mockedValidatorUtils.verify(() -&gt; ValidatorUtils.updateFieldIfNotNull(any()</span>
<span class="fc" id="L125">                    , any(), anyString(), any()));</span>

<span class="fc" id="L127">            mockedValidatorUtils.verify(() -&gt; ValidatorUtils.checkFieldNotNullAndNotEmptyOrThrowException(any(), anyString(), any()));</span>

<span class="fc" id="L129">            assertNotNull(product);</span>
<span class="fc" id="L130">            assertNotNull(product.getId());</span>
<span class="fc" id="L131">            assertEquals(TestConstants.ID, product.getId());</span>
<span class="fc" id="L132">            assertEquals(TestConstants.PRODUCT_UPDATED_NAME, product.getName());</span>
<span class="fc" id="L133">            assertEquals(TestConstants.PRODUCT_DESCRIPTION, product.getDescription());</span>
<span class="fc" id="L134">            assertEquals(TestConstants.PRODUCT_UPDATED_PRICE, product.getPrice());</span>
<span class="fc" id="L135">            assertEquals(TestConstants.PRODUCT_QUANTITY, product.getQuantity());</span>
        }
<span class="fc" id="L137">    }</span>


    @Test
    void testUpdateProduct_WhenProductIsNotFound_ShouldThrowProductNotFoundException() {

<span class="fc" id="L143">        ProductNotFoundException exception = assertThrows(ProductNotFoundException.class,</span>
<span class="nc" id="L144">                () -&gt; service.updateProduct(productVO));</span>

<span class="fc" id="L146">        assertNotNull(exception);</span>
<span class="fc" id="L147">        assertEquals(ProductNotFoundException.ERROR.formatErrorMessage(PRODUCT_NOT_FOUND)</span>
<span class="fc" id="L148">                , exception.getMessage());</span>
<span class="fc" id="L149">    }</span>

    @Test
    void testFindProductById_WhenProductWasFoundById_ShouldReturnProductObject() {

<span class="fc" id="L154">        when(repository.findById(anyString())).thenReturn(Optional.of(productEntity));</span>

<span class="fc" id="L156">        ProductVO product = service.findProductById(TestConstants.ID);</span>

<span class="fc" id="L158">        verify(repository, times(1)).findById(anyString());</span>

<span class="fc" id="L160">        assertNotNull(product);</span>
<span class="fc" id="L161">        assertNotNull(product.getId());</span>
<span class="fc" id="L162">        assertEquals(TestConstants.ID, product.getId());</span>
<span class="fc" id="L163">        assertEquals(TestConstants.PRODUCT_NAME, product.getName());</span>
<span class="fc" id="L164">        assertEquals(TestConstants.PRODUCT_DESCRIPTION, product.getDescription());</span>
<span class="fc" id="L165">        assertEquals(TestConstants.PRODUCT_PRICE, product.getPrice());</span>
<span class="fc" id="L166">        assertEquals(TestConstants.PRODUCT_QUANTITY, product.getQuantity());</span>
<span class="fc" id="L167">    }</span>

    @Test
    void testFindProductById_WhenProductWasNotFoundById_ShouldThrowProductNotFoundException() {

<span class="fc" id="L172">        ProductNotFoundException exception = assertThrows(ProductNotFoundException.class,</span>
<span class="nc" id="L173">                () -&gt; service.findProductById(TestConstants.ID));</span>

<span class="fc" id="L175">        assertNotNull(exception);</span>
<span class="fc" id="L176">        assertEquals(ProductNotFoundException.ERROR.formatErrorMessage(PRODUCT_NOT_FOUND)</span>
<span class="fc" id="L177">                , exception.getMessage());</span>

<span class="fc" id="L179">    }</span>

    @Test
    void testFindProductsByName_WhenProductsAreFounded_ShouldReturnPaginatedProducts() {

<span class="fc" id="L184">        List&lt;ProductEntity&gt; products = List.of(productEntity);</span>
<span class="fc" id="L185">        when(repository.findByProductName(anyString(), any(Pageable.class))).thenReturn(new PageImpl&lt;&gt;(products));</span>

<span class="fc" id="L187">        PageRequest pageRequest = PageRequest.of(0, 10);</span>
<span class="fc" id="L188">        Page&lt;ProductVO&gt; paginatedProducts = service.findProductsByName(TestConstants.PRODUCT_NAME, pageRequest);</span>

<span class="fc" id="L190">        verify(repository, times(1)).findByProductName(anyString(), any(Pageable.class));</span>
<span class="fc" id="L191">        ProductVO product = paginatedProducts.getContent().getFirst();</span>

<span class="fc" id="L193">        assertNotNull(paginatedProducts);</span>
<span class="fc" id="L194">        assertNotNull(product);</span>
<span class="fc" id="L195">        assertNotNull(product.getId());</span>
<span class="fc" id="L196">        assertEquals(1, paginatedProducts.getContent().size());</span>

<span class="fc" id="L198">        assertEquals(TestConstants.ID, product.getId());</span>
<span class="fc" id="L199">        assertEquals(TestConstants.PRODUCT_NAME, product.getName());</span>
<span class="fc" id="L200">        assertEquals(TestConstants.PRODUCT_DESCRIPTION, product.getDescription());</span>
<span class="fc" id="L201">        assertEquals(TestConstants.PRODUCT_PRICE, product.getPrice());</span>
<span class="fc" id="L202">        assertEquals(TestConstants.PRODUCT_QUANTITY, product.getQuantity());</span>

<span class="fc" id="L204">    }</span>

    @Test
    void testFindAllProducts_WhenProductsAreFounded_ShouldReturnPaginatedProducts() {

<span class="fc" id="L209">        List&lt;ProductEntity&gt; products = List.of(productEntity);</span>
<span class="fc" id="L210">        when(repository.findAll(any(Pageable.class))).thenReturn(new PageImpl&lt;&gt;(products));</span>

<span class="fc" id="L212">        PageRequest pageRequest = PageRequest.of(0, 10);</span>
<span class="fc" id="L213">        Page&lt;ProductVO&gt; paginatedProducts = service.findAllProducts(pageRequest);</span>

<span class="fc" id="L215">        verify(repository, times(1)).findAll(any(Pageable.class));</span>
<span class="fc" id="L216">        ProductVO product = paginatedProducts.getContent().getFirst();</span>

<span class="fc" id="L218">        assertNotNull(paginatedProducts);</span>
<span class="fc" id="L219">        assertNotNull(product);</span>
<span class="fc" id="L220">        assertNotNull(product.getId());</span>
<span class="fc" id="L221">        assertEquals(1, paginatedProducts.getContent().size());</span>

<span class="fc" id="L223">        assertEquals(TestConstants.ID, product.getId());</span>
<span class="fc" id="L224">        assertEquals(TestConstants.PRODUCT_NAME, product.getName());</span>
<span class="fc" id="L225">        assertEquals(TestConstants.PRODUCT_DESCRIPTION, product.getDescription());</span>
<span class="fc" id="L226">        assertEquals(TestConstants.PRODUCT_PRICE, product.getPrice());</span>
<span class="fc" id="L227">        assertEquals(TestConstants.PRODUCT_QUANTITY, product.getQuantity());</span>

<span class="fc" id="L229">    }</span>

    @Test
    void testDeleteProduct_WhenProductWasDeleted_ShouldReturnNothing() {

<span class="fc" id="L234">        when(repository.findById(anyString())).thenReturn(Optional.of(productEntity));</span>
<span class="fc" id="L235">        doNothing().when(repository).delete(any());</span>

<span class="fc" id="L237">        service.deleteProduct(TestConstants.ID);</span>

<span class="fc" id="L239">        verify(repository, times(1)).findById(anyString());</span>
<span class="fc" id="L240">        verify(repository, times(1)).delete(any());</span>
<span class="fc" id="L241">    }</span>

    @Test
    void TestDeleteProduct_WhenProductWasFoundById_ShouldThrowProductNotFoundException() {

<span class="fc" id="L246">        ProductNotFoundException exception = assertThrows(ProductNotFoundException.class,</span>
<span class="nc" id="L247">                () -&gt; service.deleteProduct(TestConstants.ID));</span>

<span class="fc" id="L249">        assertNotNull(exception);</span>
<span class="fc" id="L250">        assertEquals(ProductNotFoundException.ERROR.formatErrorMessage(PRODUCT_NOT_FOUND), exception.getMessage());</span>
<span class="fc" id="L251">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>