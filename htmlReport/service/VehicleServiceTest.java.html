<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VehicleServiceTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">All in Real-TimeDeliveryTrackingSystem (1) Coverage Results</a> &gt; <a href="index.source.html" class="el_package">service</a> &gt; <span class="el_source">VehicleServiceTest.java</span></div><h1>VehicleServiceTest.java</h1><pre class="source lang-java linenums">package service;

import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.entity.VehicleEntity;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.entity.values.VehicleVO;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.exception.driver.DuplicatedLicensePlateException;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.exception.vehicle.VehicleNotFoundException;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.repository.VehicleRepository;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.service.vehicle.VehicleService;
import com.github.Real_TimeDeliveryTrackingSystem.Real_TimeDeliveryTrackingSystem.utils.ValidatorUtils;
import constants.TestConstants;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.MockedStatic;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;

import java.util.List;
import java.util.Optional;

import static org.junit.Assert.assertThrows;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.Mockito.doNothing;
import static org.mockito.Mockito.mockStatic;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

@ExtendWith(MockitoExtension.class)
<span class="fc" id="L38">class VehicleServiceTest {</span>

    private static final String VEHICLE_NOT_FOUND = &quot;These Vehicle was Not Found&quot;;

    private static final String DUPLICATED_LICENSE_PLATE_MESSAGE = &quot;That license plate already registered in the system. &quot; +
            &quot;Please verify the license plate and try again!.&quot;;

    private static final String LICENSE_PLATE = &quot;AQE1F34&quot;;
    private static final String UPDATED_LICENSE_PLATE = &quot;AXE1F34&quot;;

    @Mock
    private VehicleRepository repository;

    @Mock
    private VehicleVO vehicleVO;

    @Mock
    private VehicleEntity vehicleEntity;

    @InjectMocks
    private VehicleService service;

    @BeforeEach
    void setUp() {
<span class="fc" id="L62">        vehicleVO = new VehicleVO(TestConstants.ID, TestConstants.VEHICLE_NAME,</span>
                LICENSE_PLATE, TestConstants.VEHICLE_TYPE, TestConstants.VEHICLE_STATUS);

<span class="fc" id="L65">        vehicleEntity = new VehicleEntity(TestConstants.ID, TestConstants.VEHICLE_NAME,</span>
                LICENSE_PLATE, TestConstants.VEHICLE_TYPE, TestConstants.VEHICLE_STATUS);
<span class="fc" id="L67">    }</span>

    @Test
    void testCreateVehicle_WhenSuccessful_ShouldReturnVehicleVOObject() {

<span class="fc" id="L72">        try (MockedStatic&lt;ValidatorUtils&gt; mockedValidatorUtils = mockStatic(ValidatorUtils.class)) {</span>
<span class="fc" id="L73">            mockedValidatorUtils.when(() -&gt; ValidatorUtils.checkObjectIsNullOrThrowException(any(), anyString(), any())).thenAnswer(invocation -&gt; null);</span>
<span class="fc" id="L74">            mockedValidatorUtils.when(() -&gt; ValidatorUtils.checkFieldNotNullAndNotEmptyOrThrowException(any(), anyString(), any())).thenAnswer(invocation -&gt; null);</span>
<span class="fc" id="L75">            when(repository.save(any(VehicleEntity.class))).thenReturn(vehicleEntity);</span>

<span class="fc" id="L77">            VehicleVO savedVehicle = service.create(vehicleVO);</span>
<span class="fc" id="L78">            mockedValidatorUtils.verify(() -&gt; ValidatorUtils.checkObjectIsNullOrThrowException(any(), anyString(), any()));</span>
<span class="fc" id="L79">            mockedValidatorUtils.verify(() -&gt; ValidatorUtils.checkFieldNotNullAndNotEmptyOrThrowException(any(), anyString(), any()));</span>
<span class="fc" id="L80">            verify(repository, times(1)).save(any(VehicleEntity.class));</span>

<span class="fc" id="L82">            assertNotNull(savedVehicle);</span>
<span class="fc" id="L83">            assertNotNull(savedVehicle.getId());</span>
<span class="fc" id="L84">            assertEquals(TestConstants.ID, savedVehicle.getId());</span>
<span class="fc" id="L85">            assertEquals(TestConstants.VEHICLE_NAME, savedVehicle.getName());</span>
<span class="fc" id="L86">            assertEquals(LICENSE_PLATE, savedVehicle.getLicensePlate());</span>
<span class="fc" id="L87">            assertEquals(TestConstants.VEHICLE_TYPE, savedVehicle.getType());</span>
<span class="fc" id="L88">            assertEquals(TestConstants.VEHICLE_STATUS, savedVehicle.getStatus());</span>


        }

<span class="fc" id="L93">    }</span>

    @Test
    void testCreateVehicle_WhenVehicleNotFound_ShouldThrowVehicleNotFoundException() {

<span class="pc" id="L98">        VehicleNotFoundException exception = assertThrows(VehicleNotFoundException.class, () -&gt; service.create(null));</span>
<span class="fc" id="L99">        assertNotNull(exception);</span>
<span class="fc" id="L100">        assertEquals(VehicleNotFoundException.ERROR.formatErrorMessage(VEHICLE_NOT_FOUND), exception.getMessage());</span>

<span class="fc" id="L102">    }</span>

    @Test
    void testCreateVehicle_WhenLicensePlateIsADuplicatedValue_ShouldThrowDuplicatedLicensePlateException() {

<span class="fc" id="L107">        when(repository.findByLicensePlate(any(String.class))).thenReturn(Optional.of(vehicleEntity));</span>
<span class="pc" id="L108">        DuplicatedLicensePlateException exception = assertThrows(DuplicatedLicensePlateException.class, () -&gt; service.create(vehicleVO));</span>
<span class="fc" id="L109">        assertNotNull(exception);</span>
<span class="fc" id="L110">        assertEquals(DuplicatedLicensePlateException.ERROR.formatErrorMessage(DUPLICATED_LICENSE_PLATE_MESSAGE), exception.getMessage());</span>

<span class="fc" id="L112">    }</span>

    @Test
    void testUpdateVehicle_WhenSuccessful_ShouldReturnUpdatedVehicleVOObject() {

<span class="fc" id="L117">        try (MockedStatic&lt;ValidatorUtils&gt; mockedValidatorUtils = mockStatic(ValidatorUtils.class)) {</span>
<span class="fc" id="L118">            vehicleEntity.setLicensePlate(UPDATED_LICENSE_PLATE);</span>
<span class="fc" id="L119">            vehicleEntity.setName(TestConstants.VEHICLE_UPDATED_NAME);</span>

<span class="fc" id="L121">            mockedValidatorUtils.when(() -&gt; ValidatorUtils.updateFieldIfNotNull(any(VehicleEntity.class), any(), anyString(), any()))</span>
<span class="fc" id="L122">                    .thenAnswer(invocation -&gt; vehicleEntity);</span>
<span class="fc" id="L123">            when(repository.findById(TestConstants.ID)).thenReturn(Optional.of(vehicleEntity));</span>
<span class="fc" id="L124">            when(repository.save(any(VehicleEntity.class))).thenReturn(vehicleEntity);</span>

<span class="fc" id="L126">            VehicleVO updatedVehicle = service.update(vehicleVO);</span>
<span class="fc" id="L127">            mockedValidatorUtils.verify(() -&gt; ValidatorUtils.updateFieldIfNotNull(any(VehicleEntity.class), any(VehicleVO.class), anyString(), any()));</span>
<span class="fc" id="L128">            verify(repository, times(1)).findById(anyString());</span>
<span class="fc" id="L129">            verify(repository, times(1)).save(any(VehicleEntity.class));</span>

<span class="fc" id="L131">            assertNotNull(updatedVehicle);</span>
<span class="fc" id="L132">            assertNotNull(updatedVehicle.getId());</span>
<span class="fc" id="L133">            assertEquals(TestConstants.ID, updatedVehicle.getId());</span>
<span class="fc" id="L134">            assertEquals(TestConstants.VEHICLE_UPDATED_NAME, updatedVehicle.getName());</span>
<span class="fc" id="L135">            assertEquals(UPDATED_LICENSE_PLATE, updatedVehicle.getLicensePlate());</span>
<span class="fc" id="L136">            assertEquals(TestConstants.VEHICLE_TYPE, updatedVehicle.getType());</span>
<span class="fc" id="L137">            assertEquals(TestConstants.VEHICLE_STATUS, updatedVehicle.getStatus());</span>


        }
<span class="fc" id="L141">    }</span>

    @Test
    void testUpdatedVehicle_WhenVehicleNotFound_ShouldThrowVehicleNotFoundException() {

<span class="pc" id="L146">        VehicleNotFoundException exception = assertThrows(VehicleNotFoundException.class, () -&gt; service.update(vehicleVO));</span>
<span class="fc" id="L147">        assertNotNull(exception);</span>
<span class="fc" id="L148">        assertEquals(VehicleNotFoundException.ERROR.formatErrorMessage(VEHICLE_NOT_FOUND), exception.getMessage());</span>

<span class="fc" id="L150">    }</span>

    @Test
    void testFindVehicleById_WhenSuccessful_ShouldReturnVehicleVOObject() {

<span class="fc" id="L155">        when(repository.findById(anyString())).thenReturn(Optional.of(vehicleEntity));</span>

<span class="fc" id="L157">        VehicleVO vehicleRetrieved = service.findById(TestConstants.ID);</span>

<span class="fc" id="L159">        verify(repository, times(1)).findById(anyString());</span>

<span class="fc" id="L161">        assertNotNull(vehicleRetrieved);</span>
<span class="fc" id="L162">        assertNotNull(vehicleRetrieved.getId());</span>
<span class="fc" id="L163">        assertEquals(TestConstants.ID, vehicleRetrieved.getId());</span>
<span class="fc" id="L164">        assertEquals(TestConstants.VEHICLE_NAME, vehicleRetrieved.getName());</span>
<span class="fc" id="L165">        assertEquals(LICENSE_PLATE, vehicleRetrieved.getLicensePlate());</span>
<span class="fc" id="L166">        assertEquals(TestConstants.VEHICLE_TYPE, vehicleRetrieved.getType());</span>
<span class="fc" id="L167">        assertEquals(TestConstants.VEHICLE_STATUS, vehicleRetrieved.getStatus());</span>

<span class="fc" id="L169">    }</span>

    @Test
    void testFindVehicleById_WhenVehicleNotFound_ShouldThrowVehicleNotFoundException() {

<span class="pc" id="L174">        VehicleNotFoundException exception = assertThrows(VehicleNotFoundException.class, () -&gt; service.findById(TestConstants.ID));</span>
<span class="fc" id="L175">        assertNotNull(exception);</span>
<span class="fc" id="L176">        assertEquals(VehicleNotFoundException.ERROR.formatErrorMessage(VEHICLE_NOT_FOUND), exception.getMessage());</span>

<span class="fc" id="L178">    }</span>

    @Test
    void testFindVehicleByLicensePlate_WhenSuccessful_ShouldReturnVehicleVOObject() {

<span class="fc" id="L183">        when(repository.findByLicensePlate(anyString())).thenReturn(Optional.of(vehicleEntity));</span>

<span class="fc" id="L185">        VehicleVO vehicleRetrieved = service.findByLicensePlate(LICENSE_PLATE);</span>

<span class="fc" id="L187">        verify(repository, times(1)).findByLicensePlate(anyString());</span>

<span class="fc" id="L189">        assertNotNull(vehicleRetrieved);</span>
<span class="fc" id="L190">        assertNotNull(vehicleRetrieved.getId());</span>
<span class="fc" id="L191">        assertEquals(TestConstants.ID, vehicleRetrieved.getId());</span>
<span class="fc" id="L192">        assertEquals(TestConstants.VEHICLE_NAME, vehicleRetrieved.getName());</span>
<span class="fc" id="L193">        assertEquals(LICENSE_PLATE, vehicleRetrieved.getLicensePlate());</span>
<span class="fc" id="L194">        assertEquals(TestConstants.VEHICLE_TYPE, vehicleRetrieved.getType());</span>
<span class="fc" id="L195">        assertEquals(TestConstants.VEHICLE_STATUS, vehicleRetrieved.getStatus());</span>

<span class="fc" id="L197">    }</span>

    @Test
    void testFindVehicleByLicensePlate_WhenVehicleNotFound_ShouldThrowVehicleNotFoundException() {

<span class="pc" id="L202">        VehicleNotFoundException exception = assertThrows(VehicleNotFoundException.class, () -&gt; service.findByLicensePlate(LICENSE_PLATE));</span>
<span class="fc" id="L203">        assertNotNull(exception);</span>
<span class="fc" id="L204">        assertEquals(VehicleNotFoundException.ERROR.formatErrorMessage(VEHICLE_NOT_FOUND), exception.getMessage());</span>

<span class="fc" id="L206">    }</span>

    @Test
    void testFindAllVehicles_WhenSuccessful_ShouldReturnPaginatedVehicles() {

<span class="fc" id="L211">        List&lt;VehicleEntity&gt; vehiclesEntities = List.of(vehicleEntity);</span>
<span class="fc" id="L212">        when(repository.findAll(any(Pageable.class))).thenReturn(new PageImpl&lt;&gt;(vehiclesEntities));</span>
<span class="fc" id="L213">        PageRequest pageRequest = PageRequest.of(0, 10);</span>
<span class="fc" id="L214">        Page&lt;VehicleVO&gt; vehicles = service.findAll(pageRequest);</span>
<span class="fc" id="L215">        verify(repository, times(1)).findAll(any(Pageable.class));</span>

<span class="fc" id="L217">        VehicleVO vehicleRetrieved = vehicles.getContent().getFirst();</span>

<span class="fc" id="L219">        assertNotNull(vehicleRetrieved);</span>
<span class="fc" id="L220">        assertNotNull(vehicleRetrieved.getId());</span>
<span class="fc" id="L221">        assertEquals(1, vehicles.getContent().size());</span>
<span class="fc" id="L222">        assertEquals(TestConstants.ID, vehicleRetrieved.getId());</span>
<span class="fc" id="L223">        assertEquals(TestConstants.VEHICLE_NAME, vehicleRetrieved.getName());</span>
<span class="fc" id="L224">        assertEquals(LICENSE_PLATE, vehicleRetrieved.getLicensePlate());</span>
<span class="fc" id="L225">        assertEquals(TestConstants.VEHICLE_TYPE, vehicleRetrieved.getType());</span>
<span class="fc" id="L226">        assertEquals(TestConstants.VEHICLE_STATUS, vehicleRetrieved.getStatus());</span>
<span class="fc" id="L227">    }</span>

    @Test
    void testDeleteVehicle_WhenSuccessful_ThenDoNothing() {
<span class="fc" id="L231">        when(repository.findById(anyString())).thenReturn(Optional.of(vehicleEntity));</span>
<span class="fc" id="L232">        doNothing().when(repository).delete(vehicleEntity);</span>

<span class="fc" id="L234">        service.delete(TestConstants.ID);</span>
<span class="fc" id="L235">        verify(repository, times(1)).findById(anyString());</span>
<span class="fc" id="L236">        verify(repository, times(1)).delete(any(VehicleEntity.class));</span>
<span class="fc" id="L237">    }</span>

    @Test
    void testDeleteVehicle_WhenVehicleNotFound_ShouldThrowVehicleNotFoundException() {

<span class="pc" id="L242">        VehicleNotFoundException exception = assertThrows(VehicleNotFoundException.class, () -&gt; service.delete(TestConstants.ID));</span>
<span class="fc" id="L243">        assertNotNull(exception);</span>
<span class="fc" id="L244">        assertEquals(VehicleNotFoundException.ERROR.formatErrorMessage(VEHICLE_NOT_FOUND), exception.getMessage());</span>

<span class="fc" id="L246">    }</span>
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>